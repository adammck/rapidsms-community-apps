{% load query_log %}
{% query_log_vars %}

<div id="query-log" class="module">
	<div>
		<h2>Query Log</h2>
		<table>
			<thead>
				<tr>
					<th>Time</th>
					<th>SQL</th>
				</tr>
			</thead>
			
			<!-- TODO: wtf is this inline style doing here -->
			<tbody style="font: 80% monospace; line-height: 1.4;">{% for q in queries %}
				<tr>
					<td>{{ q.time }}</td>
					<td>{{ q.sql }}</td>
				</tr>{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<script type="text/javascript">
	$(function() {
		var container = $("#query-log");
		var log = container.children("div");
		
		/* hide the log as default, since
		 * it's huge and rather ugly */
		log.hide();
	  
		/* create a trigger div, to show the log this is done
		 * here, rather than in the HTML, since the event won't
		 * fire unless Javascript is enabled (and the query log
		 * won't be hidden, anyway) */
		container.append(
		  	$('<div class="trigger"></div>').
		  	text("Show {{ queries|length }} SQL Queries").
		  	click(function(ev) {
		  		$(ev.target).hide();
		  		log.slideDown();
		  	})
		);
	});
</script>
